<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Blizzard Break</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  background: #87ceeb;
  font-family: Arial;
  text-align: center;
}
canvas {
  display: block;
  margin: auto;
  background: linear-gradient(#ffffff, #dfefff);
}
#ui, #mobileControls {
  padding: 10px;
}
#mobileControls button {
  width: 45%;
  height: 60px;
  font-size: 24px;
}
.hidden { display: none; }
</style>
</head>

<body>

<h2>ğŸ›· Blizzard Break</h2>
<canvas id="game" width="420" height="600"></canvas>

<div id="ui">
  <p id="stats"></p>
  <button onclick="prestige()">Prestige Reset</button>
</div>

<div id="mobileControls" class="hidden">
  <button ontouchstart="left=true" ontouchend="left=false">â¬…ï¸</button>
  <button ontouchstart="right=true" ontouchend="right=false">â¡ï¸</button>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
/* ğŸ”¥ FIREBASE CONFIG â€” REPLACE WITH YOUR OWN */
const firebaseConfig = {
  apiKey: "YOUR_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ğŸ“± MOBILE DETECTION */
const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
if (isMobile) {
  document.getElementById("mobileControls").classList.remove("hidden");
}

/* ğŸ¨ CANVAS */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* ğŸ® INPUT */
let left = false, right = false;
document.addEventListener("keydown", e => {
  if (e.key === "ArrowLeft") left = true;
  if (e.key === "ArrowRight") right = true;
});
document.addEventListener("keyup", e => {
  if (e.key === "ArrowLeft") left = false;
  if (e.key === "ArrowRight") right = false;
});

/* ğŸ–¼ï¸ SPRITES */
const sledImg = new Image(); sledImg.src = "sprites/sled.png";
const rockImg = new Image(); rockImg.src = "sprites/rock.png";
const coinImg = new Image(); coinImg.src = "sprites/coin.png";

/* ğŸ”Š SOUNDS */
const crashSound = new Audio("sounds/crash.wav");
const coinSound = new Audio("sounds/coin.wav");
const music = new Audio("sounds/music.mp3");
music.loop = true;
music.volume = 0.4;
document.body.addEventListener("click", () => music.play(), { once: true });

/* ğŸ’¾ SAVE DATA */
let save = JSON.parse(localStorage.getItem("save")) || {
  coins: 0,
  prestige: 0,
  best: 0
};

/* ğŸ§  GAME STATE */
let player, obstacles, coins, distance, gameOver;

/* ğŸ” RESET GAME */
function reset() {
  player = { x: 190, y: 520, w: 40, h: 40 };
  obstacles = [];
  coins = [];
  distance = 0;
  gameOver = false;
}
reset();

/* ğŸª¨ SPAWN ROCK */
function spawnObstacle() {
  obstacles.push({
    x: Math.random() * 380,
    y: -40,
    s: 32
  });
}

/* ğŸª™ SPAWN COIN */
function spawnCoin() {
  coins.push({
    x: Math.random() * 380,
    y: -30,
    s: 24,
    spin: 0
  });
}

/* ğŸ”„ UPDATE GAME */
function update() {
  if (gameOver) return;

  let speed = 4 + save.prestige * 0.5;
  distance += speed * 0.02;

  if (Math.random() < 0.02) spawnObstacle();
  if (Math.random() < 0.015) spawnCoin();

  if (left) player.x -= 5;
  if (right) player.x += 5;
  player.x = Math.max(0, Math.min(380, player.x));

  /* ğŸª¨ OBSTACLES */
  obstacles.forEach(o => {
    o.y += speed;
    if (
      player.x < o.x + o.s &&
      player.x + player.w > o.x &&
      player.y < o.y + o.s &&
      player.y + player.h > o.y
    ) {
      crashSound.play();
      endGame();
    }
  });

  /* ğŸª™ COINS */
  coins.forEach(c => {
    c.y += speed;
    c.spin += 0.15;

    if (
      player.x < c.x + c.s &&
      player.x + player.w > c.x &&
      player.y < c.y + c.s &&
      player.y + player.h > c.y
    ) {
      coinSound.play();
      save.coins += 1;
      c.collected = true;
    }
  });

  obstacles = obstacles.filter(o => o.y < 650);
  coins = coins.filter(c => c.y < 650 && !c.collected);
}

/* ğŸ’¥ END GAME */
function endGame() {
  gameOver = true;
  save.coins += Math.floor(distance * (1 + save.prestige * 0.5));
  save.best = Math.max(save.best, distance);
  localStorage.setItem("save", JSON.stringify(save));

  db.collection("scores").add({
    distance: Math.floor(distance),
    prestige: save.prestige,
    time: Date.now()
  });
}

/* ğŸ¨ DRAW */
function draw() {
  ctx.clearRect(0, 0, 420, 600);

  ctx.drawImage(sledImg, player.x, player.y, player.w, player.h);

  obstacles.forEach(o => {
    ctx.drawImage(rockImg, o.x, o.y, o.s, o.s);
  });

  coins.forEach(c => {
    ctx.save();
    ctx.translate(c.x + c.s / 2, c.y + c.s / 2);
    ctx.scale(Math.cos(c.spin), 1);
    ctx.drawImage(coinImg, -c.s / 2, -c.s / 2, c.s, c.s);
    ctx.restore();
  });
}

/* ğŸ” LOOP */
function loop() {
  update();
  draw();

  document.getElementById("stats").innerText =
    `Distance: ${distance.toFixed(1)} | Coins: ${save.coins} | Prestige: ${save.prestige}`;

  requestAnimationFrame(loop);
}
loop();

/* â­ PRESTIGE */
function prestige() {
  if (save.best >= 500) {
    save.coins = 0;
    save.best = 0;
    save.prestige++;
    localStorage.setItem("save", JSON.stringify(save));
    reset();
  }
}
</script>

</body>
</html>
