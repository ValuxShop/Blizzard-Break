<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Blizzard Break</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { margin:0; overflow:hidden; background:#87ceeb; font-family:Arial; }
canvas { display:block; background: linear-gradient(#fff,#dfefff); }
#ui { position:absolute; top:10px; left:10px; color:#000; font-size:18px; }
#mobileControls { position:absolute; bottom:10px; width:100%; text-align:center; }
#mobileControls button { width:45%; height:60px; font-size:24px; }
.hidden { display:none; }
</style>
</head>
<body>
<canvas id="game"></canvas>
<div id="ui">
  <p id="stats">Speed: 0 | Distance: 0 | Score: 0</p>
</div>
<div id="mobileControls" class="hidden">
  <button ontouchstart="left=true" ontouchend="left=false">‚¨ÖÔ∏è</button>
  <button ontouchstart="right=true" ontouchend="right=false">‚û°Ô∏è</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
// üî• FIREBASE
const firebaseConfig = { apiKey: "YOUR_KEY", authDomain: "YOUR_PROJECT.firebaseapp.com", projectId: "YOUR_PROJECT" };
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// MOBILE DETECTION
const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
if(isMobile) document.getElementById("mobileControls").classList.remove("hidden");

// CANVAS
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
function resizeCanvas(){ canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
window.addEventListener('resize',resizeCanvas);
resizeCanvas();

// INPUT
let left=false,right=false;
document.addEventListener("keydown", e=>{ if(e.key==="ArrowLeft") left=true; if(e.key==="ArrowRight") right=true; });
document.addEventListener("keyup", e=>{ if(e.key==="ArrowLeft") left=false; if(e.key==="ArrowRight") right=false; });

// SPRITES
const sledImg = new Image(); sledImg.src="sprites/sled.png";
const rockImg = new Image(); rockImg.src="sprites/rock.png";
const treeImg = new Image(); treeImg.src="sprites/tree.png";

// SOUNDS
const crashSound = new Audio("sounds/crash.wav");
const coinSound = new Audio("sounds/coin.wav");
const music = new Audio("sounds/music.mp3"); music.loop=true; music.volume=0.4;
document.body.addEventListener("click", ()=>music.play().catch(()=>{}), {once:true});

// SAVE
let save = JSON.parse(localStorage.getItem("save")) || { coins:0, prestige:0, best:0 };

// GAME STATE
let player, obstacles=[], distance=0, speed=6, gameOver=false;
function reset(){
  player={x:canvas.width/2-40/2, y:canvas.height-100, w:40,h:40};
  obstacles=[];
  distance=0;
  speed=6;
  gameOver=false;
}
reset();

// 3D Perspective Utility
function projectY(y, depth){ return canvas.height - (y / depth); }
function projectX(x, depth){ return canvas.width/2 + (x - canvas.width/2)*(1/depth); }
function projectSize(s, depth){ return s*(1/depth); }

// SPAWN OBSTACLES
function spawnObstacle(){
  let type = Math.random()<0.5 ? 'rock':'tree';
  let x = Math.random()*canvas.width;
  let y = -50;
  obstacles.push({x,y,type});
}

// UPDATE
function update(){
  if(gameOver) return;
  distance += speed*0.05;
  
  // Player movement
  if(left) player.x -= speed;
  if(right) player.x += speed;
  player.x = Math.max(0, Math.min(canvas.width-player.w, player.x));
  
  // Spawn obstacles
  if(Math.random()<0.02) spawnObstacle();
  
  // Move obstacles (simulate coming towards player)
  obstacles.forEach(o=>{
    o.y += speed;
    
    // Collision check (simple rectangle)
    let obsW=50, obsH=50;
    if(player.x < o.x+obsW && player.x+player.w > o.x &&
       player.y < o.y+obsH && player.y+player.h > o.y){
      crashSound.play();
      endGame();
    }
  });
  
  obstacles = obstacles.filter(o=>o.y<canvas.height+100);
}

// DRAW
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  
  // Draw ground (simple 3D slope effect)
  let grd = ctx.createLinearGradient(0,0,0,canvas.height);
  grd.addColorStop(0,"#fff");
  grd.addColorStop(1,"#dfefff");
  ctx.fillStyle = grd;
  ctx.fillRect(0,0,canvas.width,canvas.height);
  
  // Draw obstacles
  obstacles.forEach(o=>{
    let scale = 1 - o.y/canvas.height;
    let img = o.type==='rock'?rockImg:treeImg;
    let w = img.width*scale || 32*scale;
    let h = img.height*scale || 32*scale;
    ctx.drawImage(img, o.x, o.y, w, h);
  });
  
  // Draw player
  ctx.drawImage(sledImg, player.x, player.y, player.w, player.h);
  
  // UI
  document.getElementById("stats").innerText = 
    `Speed: ${speed.toFixed(1)} | Distance: ${Math.floor(distance)} | Score: ${save.coins}`;
}

// END GAME
function endGame(){
  gameOver=true;
  save.coins += Math.floor(distance*(1+save.prestige*0.5));
  save.best = Math.max(save.best, distance);
  localStorage.setItem("save",JSON.stringify(save));
  
  db.collection("scores").add({
    distance: Math.floor(distance),
    prestige: save.prestige,
    time: Date.now()
  });
}

// GAME LOOP
function loop(){ update(); draw(); requestAnimationFrame(loop); }
loop();

// PRESTIGE
function prestige(){
  if(save.best>=500){
    save.coins=0;
    save.best=0;
    save.prestige++;
    localStorage.setItem("save",JSON.stringify(save));
    reset();
  }
}
</script>
</body>
</html>
